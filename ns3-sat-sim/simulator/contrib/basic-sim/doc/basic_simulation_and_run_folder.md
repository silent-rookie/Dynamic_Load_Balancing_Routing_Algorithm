# Basic simulation / run folder

The `BasicSimulation` class is just a wrapper which makes managing the simulation easier. Essentially, it is a super complicated way to write 4 lines of ns-3 C++ code:

```
ns3::RngSeedManager::SetSeed(simulation_seed);
Simulator::Stop(NanoSeconds(simulation_end_time_ns));
Simulator::Run();
Simulator::Destroy();
```

However, it offers a lot of (often needed) experiment functionality out-of-the-box. It allows you to read and manage a configuration file. It keeps track of time and shows progress. It does a two-phase writing in a file called 'finished.txt' ("No" at the start, "Yes" after the run) to be able to verify that the run finished successfully. It also supports a way to integrate distributed simulation a bit easier.

It encompasses the following files:

* `model/core/basic-simulation.cc/h` - Basic simulation class
* `model/core/exp-util.cc/h` - A couple of handy parsing and experiment tools

Beyond this basic functionality, the basic simulation is very modularized such that you can add only what you want. The basic-sim module as a whole is divided into two sub-modules: `core` and `apps`. `core` is the framework, including an improved routing implementation (called 'arbiter routing') and topology management. `apps` is about applications to run -- either inside or outside of this framework. One can simply take the apps and use them somewhere else without even having to deal with the framework.


# Run folder

The run folder must contain the input of a simulation. The basic simulation is centered around it.

The structure is as follows:

```
run_folder
|-- config_ns3.properties
|-- ... (other optional files, e.g., topology.properties, tcp_flow_schedule.csv, ...)
```

And after the run a `logs_ns3` folder is generated:
```
run_folder
|-- (...) same as above, untouched
|-- logs_ns3
    |-- finished.txt
    |-- timing_results.txt
    |-- timing_results.csv
```


## Configuration: config_ns3.properties

General properties of the simulation. The following MUST always be defined:

* `simulation_end_time_ns` : How long to run the simulation in simulation time (ns)
* `simulation_seed` : If there is randomness present in the simulation, this guarantees reproducibility (exactly the same outcome) if the seed is the same

The following MAY be defined in order to enabled a distributed computation:

* `enable_distributed` : True iff distributed computation (true/false)
* `distributed_simulator_implementation_type` : Either `default` or `nullmsg`
* `distributed_systems_count` : How many parallel logical processes (integer; must match mpirun's `-np` argument)
* `distributed_node_system_id_assignment` : For each node which is defined just before the run call, its assigned system id (value: `list(...)`, e.g., to assign 5 nodes to two systems: `list(0, 1, 0, 0, 1)`)

Besides these, one can define any configuration properties they want. However, if a property is defined, it MUST be retrieved during the run. Of course, this is not a fool-proof safeguard as there is no guarantee it is actually applied, but it is a useful sanity check.


## Log files: logs_ns3

There are always two log files guaranteed generated by the run in the `logs_ns3` folder within the run folder:

* `finished.txt` : Contains "Yes" if the run has finished, "No" if not. (named `system_X_finished.txt` if distributed)
* `timing_results.txt` : Contains the timing moments overview. (named `system_X_timing_results.txt` if distributed)
* `timing_results.csv` : Contains the timing moments overview. (named `system_X_timing_results.csv` if distributed). The line format is as follows:

  ```
  <activity description>,<duration in nanoseconds>
  ```
  
  For example, the main one is `Run simulation,<duration in nanoseconds>`.
